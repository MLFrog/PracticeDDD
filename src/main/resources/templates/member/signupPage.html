<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<title>Study DDD project</title>
	<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
	<link href="css/sb-admin-2.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<style>
		#passwordMessage {
			font-size: 0.875em;
			height: 1em;
		}

		.error {
			border: 2px solid red;
		}
	</style>
	<script>
		$(document).ready(function() {
			$("#inputNumber").on("input", function() {
				let maxLength = 11; // 최대 길이
				let input = $(this).val(); // 입력된 문자열

				if (input.length > maxLength) {
					input = input.slice(0, maxLength);
					$(this).val(input);
				}
			});

			$("#selectEmailType").change(function() {
				let selectedValue = $(this).val();
				if (selectedValue === "직접입력") {
					$("#EmailType").prop("disabled", false).val("").focus();
				} else {
					$("#EmailType").prop("disabled", true).val(selectedValue);
				}
			});

			$("#EmailType").val($("#selectEmailType").val());

			$("#inputPassword, #inputPasswordChk").on("keyup", function() {
				let password = $("#inputPassword").val();
				let passwordChk = $("#inputPasswordChk").val();

				if (password === passwordChk) {
					$("#passwordMessage").text("비밀번호가 일치합니다.").css("color", "green");
				} else {
					$("#passwordMessage").text("비밀번호가 일치하지 않습니다.").css("color", "red");
				}
			});
		});
	</script>
</head>
<body id="page-top">
	<div id="wrapper">
		<header th:replace="~{common/Sidebar::header}"></header>
		<div id="content-wrapper" class="d-flex flex-column">
			<div id="content">
				<header th:replace="~{common/Header::header}"></header>
				<div class="container-fluid">
					<form class="row g-3">
						<div class="col-md-6">
							<input type="text" class="form-control" id="inputLoginId" placeholder="아이디">
						</div>
						<div class="col-md-1">
							<button type="button" id="idDuplicateChk" class="btn btn-outline-warning" >확인</button>
						</div>
						<div class="col-md-1">
							<button type="button" id="idDuplicateChkTrue" class="btn btn-outline-warning d-none" >수정</button>
						</div>
						<div class="col-md-6">
							<input type="password" class="form-control" id="inputPassword" placeholder="비밀번호">
						</div>
						<div class="col-md-6">
							<input type="password" class="form-control" id="inputPasswordChk" placeholder="비밀번호 확인">
						</div>
						<div class="col-md-12">
							<p id="passwordMessage"></p>
						</div>
						<div class="col-md-2">
							<label for="inputEmail" class="form-label">이메일</label>
							<input type="text" class="form-control" id="inputEmail" placeholder="example">
						</div>
						<div class="col-md-2">
							<label for="EmailType" class="form-label">구분</label>
							<input disabled type="text" class="form-control" id="EmailType">
						</div>
						<div class="col-md-2">
							<label for="selectEmailType" class="form-label">선택</label>
							<select id="selectEmailType" class="form-select">
								<option selected>@gmail.com</option>
								<option>@naver.com</option>
								<option>@yahoo.com</option>
								<option>@hanmail.net</option>
								<option>직접입력</option>
							</select>
						</div>
						<div class="col-12">
							<label for="inputNumber" class="form-label" >전화번호</label>
							<input type="text" class="form-control" id="inputNumber" placeholder="-를 제외한 숫자를 입력해 주세요."
								   oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" >
						</div>
						<div class="col-md-6">
							<label for="inputNickname" class="form-label">닉네임</label>
							<input type="text" class="form-control" id="inputNickname">
						</div>
						<div class="col-md-6">
							<label for="inputRealName" class="form-label">실명</label>
							<input type="text" class="form-control" id="inputRealName">
						</div>
						<div class="col-12">
							<label for="inputRoles" class="form-label">관리자 코드</label>
							<input type="text" class="form-control" id="inputRoles" placeholder="관리자일 경우 코드를 입력해주세요.">
						</div>
						<div class="col-12">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="agreeCheck">
								<label class="form-check-label" for="agreeCheck">
									개인정보 수집 동의
								</label>
							</div>
						</div>
						<div class="d-grid gap-2 col-6 mx-auto">
							<button class="btn btn-outline-success" id="signUpBtn" type="button">완료</button>
						</div>
					</form>
				</div>
			</div>
			<footer th:replace="~{common/Footer::footer}"></footer>
		</div>
	</div>
	<!-- Modal -->
	<div class="modal fade" id="showModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="showModalTitle"></h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(document).ready(function() {
			$("#signUpBtn").click(function() {
				let valiTp = valiInput();
				if(valiTp){
					const data = {
						loginId: $('#inputLoginId').val(),
						password: $('#inputPassword').val(),
						email: $('#inputEmail').val() + $("#EmailType").val(),
						phoneNumber: $('#inputNumber').val(),
						nickname: $('#inputNickname').val(),
						realname: $('#inputRealName').val(),
						roles: getRoleCode(),
						AGREE: getAgreeString()
					};
					$.ajax({
						type: 'POST',
						url: '/sign-up/save',
						data: JSON.stringify(data),
						contentType: 'application/json; charset=utf-8',
						success: function(response) {
							showModal('회원가입', '회원가입이 완료되었습니다. 이메일을 확인해주세요.');
						},
						error: function(error) {
							showModal('회원가입', '회원가입중 서버 오류 발생.');
						}
					});
				}
			});
			$("#idDuplicateChkTrue").click(function() {
				$("#inputLoginId").prop("disabled", false);
				$("#idDuplicateChk").removeClass('btn btn-outline-success').addClass('btn btn-outline-warning').removeClass('disabled');
				$("#idDuplicateChkTrue").addClass('d-none');
			});

			$("#idDuplicateChk").click(function() {
				if($("#inputLoginId").val().trim() !== ""){
					const data = {
						loginId: $('#inputLoginId').val()
					};

					$.ajax({
						type: 'POST',
						url: '/sign-up/idcheck',
						data: JSON.stringify(data),
						contentType: 'application/json; charset=utf-8',
						success: function(response) {
							if(response) {
								$("#inputLoginId").prop("disabled", true);
								$("#idDuplicateChk").removeClass('btn btn-outline-warning').addClass('btn btn-outline-success').addClass('disabled');
								showModal('아이디중복확인', '사용가능한 아이디 입니다.');
								$("#idDuplicateChkTrue").removeClass('d-none');
							}else {
								showModal('아이디중복확인', '이미 사용중인 아이디 입니다.');
							}
						},
						error: function(error) {
							showModal('아이디중복확인', '아이디 중복체크중 서버오류 발생.');
						}
					});
				}else{
					showModal('아이디중복확인', '아이디입력후 시도해주세요.');
				}
			});

			function valiInput(){
				$("#inputLoginId,#inputPassword,#inputPasswordChk, #inputNickname, #inputEmail, #inputRealName,#inputNumber").removeClass("error");
				let isValid = true;

				if ($("#inputLoginId").val().trim() === "") {
					$("#inputLoginId").addClass("error");
					isValid = false;
				}

				if ($("#inputPassword").val().trim() === "") {
					$("#inputPassword").addClass("error");
					isValid = false;
				}

				if ($("#inputPasswordChk").val().trim() === "") {
					$("#inputPasswordChk").addClass("error");
					isValid = false;
				}

				if ($("#inputEmail").val().trim() === "") {
					$("#inputEmail").addClass("error");
					isValid = false;
				}

				if ($("#inputNumber").val().trim() === "") {
					$("#inputNumber").addClass("error");
					isValid = false;
				}

				if ($("#inputNickname").val().trim() === "") {
					$("#inputNickname").addClass("error");
					isValid = false;
				}
				if ($("#inputRealName").val().trim() === "") {
					$("#inputRealName").addClass("error");
					isValid = false;
				}

				if ($("#passwordMessage").text()!=="비밀번호가 일치합니다.")
					isValid = false;

				if (!$("#agreeCheck").is(':checked')){
					showModal('개인정보수집동의', '개인정보 수집 동의후 회원가입이 가능합니다.');
					return false;
				}

				if (!$('#inputLoginId').is(':disabled')){
					showModal('아이디중복확인', '사용가능 아이디인지 확인후 회원가입이 가능합니다.');
					return  false;
				}
				return isValid;
			}

			function showModal(title, content) {
				let modal = new bootstrap.Modal($("#showModal"));
				$("#showModal").textContent = title;
				document.querySelector('#showModal .modal-body').textContent = content;
				modal.show();
			}

			function getAgreeString() {
				let agreeVal = "";
				if($("#agreeCheck").is(':checked'))
					agreeVal = 'T';
				else agreeVal = 'F';

				return agreeVal;
			}

			function getRoleCode() {
				let code = $('#inputRoles').val();
				let returnCode = '';
				if(code==='ADMIN'){
					returnCode = 'ADMIN';
				}else
					returnCode = 'NORMAL';
				return returnCode;
			}

		});
	</script>
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
	<script src="js/sb-admin-2.min.js"></script>
	<script src="vendor/chart.js/Chart.min.js"></script>
	<script src="js/demo/chart-area-demo.js"></script>
	<script src="js/demo/chart-pie-demo.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>

</html>